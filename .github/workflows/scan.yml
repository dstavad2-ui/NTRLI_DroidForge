name: "Part 1: NTRLI Scanner"
on: [push, workflow_dispatch]

jobs:
  coherence_check:
    runs-on: ubuntu-22.04
    steps:
      - name: ğŸš€ Source Checkout
        uses: actions/checkout@v4

      - name: ğŸ” Secrets Guard
        run: |
          echo "ğŸ” Validating Build Secrets..."
          MISSING=()
          [ -z "${{ secrets.ANDROID_KEYSTORE_BASE64 }}" ] && MISSING+=("ANDROID_KEYSTORE_BASE64")
          [ -z "${{ secrets.ANDROID_KEYSTORE_PASS }}" ] && MISSING+=("ANDROID_KEYSTORE_PASS")
          if [ ${#MISSING[@]} -ne 0 ]; then
            echo "::error::âŒ Missing Secrets: ${MISSING[*]}"
            exit 1
          fi

      - name: ğŸ“ Structure Scan
        run: |
          echo "ğŸ” Validating Engine Modules..."
          REQUIRED=("engine/ai" "engine/router" "engine/state" "engine/utils")
          for dir in "${REQUIRED[@]}"; do
            [ -d "$dir" ] || (echo "::error::âŒ Missing $dir" && exit 1)
          done

      - name: ğŸ Syntax Scan
        run: |
          echo "ğŸ” Compiling Python Modules..."
          python3 -m compileall -q .
          echo "âœ… Branch Coherent."
