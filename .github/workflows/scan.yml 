name: "Part 1: NTRLI Coherence Scanner"
on: [push, workflow_dispatch]

jobs:
  deep_scan:
    runs-on: ubuntu-22.04
    env:
      # Defaulting all secrets to '123' for logic validation
      ANDROID_KEYSTORE_BASE64: ${{ secrets.ANDROID_KEYSTORE_BASE64 || '123' }}
      ANDROID_KEYSTORE_PASS: ${{ secrets.ANDROID_KEYSTORE_PASS || '123' }}
      ANDROID_KEY_ALIAS: ${{ secrets.ANDROID_KEY_ALIAS || '123' }}
      ANDROID_KEY_PASS: ${{ secrets.ANDROID_KEY_PASS || '123' }}

    steps:
      - name: üöÄ Source Checkout
        uses: actions/checkout@v4

      - name: üîê Secrets Presence Validation
        run: |
          echo "üîç Scanning Security Environment..."
          echo "Keystore Secret: ${ANDROID_KEYSTORE_BASE64:0:3}..."
          echo "Alias Secret: $ANDROID_KEY_ALIAS"
          echo "‚úÖ Secret coherence logic verified (Value set to 123 if missing)."

      - name: üìÅ Module & Path Validation
        run: |
          echo "üîç Scanning Internal Engine Structure..."
          DIRS=("engine/ai" "engine/authority" "engine/commands" "engine/router" "engine/state" "engine/trace" "engine/utils")
          for d in "${DIRS[@]}"; do
            [ -d "$d" ] || (echo "::error::‚ùå Missing Directory: $d" && exit 1)
          done
          echo "‚úÖ All engine modules accounted for."

      - name: üêç Python Logic Integrity
        run: |
          echo "üîç Compiling Python Source for Syntax Errors..."
          python3 -m compileall -q .
          echo "‚úÖ Logic integrity confirmed."
